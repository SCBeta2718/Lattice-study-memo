# 基于格上最小整数解的密码研究

## 平均情况困难问题

- 常见问题：
  - 最小整数解问题（SIS）（派生自 SIVP）
    - 单向哈希函数
    - 抗碰撞哈希函数
    - 数字签名
    - 身份加密方案
  - 带误差学习问题（LWE）（派生自 BDD）
    - 公钥加密方案
  > **SVIP 和 BDD 的归约**：
  > - 如果能解决 SIVP 问题，就能解 BDD 问题
  > - 如果能解决 BDD 问题，就能**用量子计算机**解 SIVP 问题
- SIS
  - **随机**给定 $m$ 个 $\Z_q^n$ 中的向量，求一组非平凡（即不是全 0）的 $z_1,z_2,...,z_m \in \{-1,0,1\}$，使得 $\sum z_ia_i=0 \mod q$
    - 如果不限定 $z$ 的范围：本质是解线性方程组，高斯消元
      - 解的集合构成一个格
        - 显然任取两组解 $Z_1,Z_2$ 满足条件，$Z_1+Z_2$ 同样满足条件
        - 回到格的定义：离散加法子群
    - SIS 的本质：找到格中（在 $\infty$-范数下的）『短』向量
  - SIS 与格的两种表示：
    - 使用格基矩阵 $B$，所有的格点 $Z \in L$ 都可以被表示为 $Bx=Z,x \in \Z^n$
    - 利用 SIS 问题，构造矩阵 $A$，使得 $AZ=0 \mod q,Z \in \Z^m$，所有满足条件的 $Z$ 即为格点
  - 基于 SIS 的抗碰撞哈希函数
    > **抗碰撞哈希函数**：
    > - 考虑一族哈希函数 $H$，对于任意的函数 $h \in H$，都**很难**在定义域中找到两个元素 $x_1,x_2$，使得 $h(x_1)=h(x_2)$
    > - 注意是**很难**而非**不能**：定义域大于值域在技术上没有意义
    - 构造函数 $h_A:\{0,1\}^m \rightarrow \Z_n^q$，其定义为 $h_A([z_1,z_2,...,z_m])=\sum a_iz_i \mod q$，其中参数 $A=(a_1,a_2,..,a_m)$ 是随机选择的
      - 定义域大小是 $2^m$，值域大小是 $q^n$
      - 因为是哈希函数，所以应当满足 $2^m>q^n$，即 $m>n \log_2 q$
    - 困难性归约
      - 如果存在碰撞 $h_A(Z_1)=h_A(Z_2)$，那么显然有 $\sum a_i({z_1}_i-{z_2}_i)=0 \mod q$
      - 令 $\Delta Z=Z_1-Z_2=\{{z_1}_1-{z_2}_1,{z_1}_2-{z_2}_2,...,{z_1}_m-{z_2}_m\}$
      - 考虑 $Z_1,Z_2 \in \{0,1\}^m$，显然有 ${z_1}_i-{z_2}_i \in \{-1,0,1\}$
      - $\Delta Z \in \{-1,0,1\}^m$，且 $\sum a_i\Delta Z_i=0 \mod q$，化为 SIS 问题

---
## 正态分布与格
> **一维正态分布**：
> - $N(\mu,\sigma^2): f(x)=\exp({-(x-\mu)^2 \over 2\sigma^2})/(\sqrt{2\pi}\sigma)$
> - 格密码学中常常约化常数 $\sqrt {2\pi}$，则 $\mu=0$ 的正态分布化为：
>   - $N_s(x)=e^{-\pi x^2/s^2}/s$
>   - 标准差 $\sigma={s\over \sqrt{2\pi}}$ 
>
> **各维无关的高维正态分布**：
> - 对每一维分别取正态分布
> - 某一点的概率密度即为该点每一维的概率密度之积
>   - $N_s(X=[x_1,x_2,...,x_n])=\prod e^{-\pi x_i^2/s^2}/s=s^{-n} \exp(-{\pi \over s^2} \sum x_i^2)=s^{-n}\exp(-{\pi \over s^2} ||X||_2^2)=s^{-n}\exp(-{\pi \over s^2})^{||X||_2^2}$
> - 高维正态分布的标准差
>   - **标准差是到原点距离的期望**
>   - $\sigma=\sqrt{n(s/\sqrt{2\pi})^2}=\sqrt n s/\sqrt{2\pi}$ 
- 关注高维正态分布的三个性质：
  - 各维独立
  - 概率密度只与 $2-$范数（到原点的距离）有关
      - 可以任意选择坐标轴的朝向
  - 若 $X \sim N_{5M}(x)$，那么对于任意的 $m<M$，都有 $X \mod m \simeq U(0,m)$
      - 不严格的证明：
        - 以原点为中心，按 $m$ 为长度分段，则每一段可以近似视作线段
        - 将 $f[km,(k+1)m)$ 与 $f[-(k+1)m,-km)$ 相加，即两条对称近似线段相加，结果近似为常函数
        - 即 $f(km+x)+f(-(k+1)m+x)$ 处处约等 $(0 \leq x<m)$
        - 将这样的每一『组』相加，即证
      - $s=5M$ 或 $\sigma=2M$ 可能是比较好的近似
- 考虑模平行多面体时的均匀分布
  - 模一个各边长为 $A=[a_1,a_2,...,a_n]$ ，端点位于原点，各边平行于轴的『方盒』
      - 注意正态分布对**任意**足够小的 $m$ 都有 $X \mod m \simeq U(0,m)$
      - $s=5||A||_\infty$
  - 模一个旋转后的方盒
      - 概率密度只与到原点的距离有关
      - 等同于模普通方盒
  - 一般问题：已知某分布 $N$ 在模平行多面体 $A$ （比如一个旋转方盒）下均匀，那么在另一平行多面体 $B$ 下是否均匀？
      - 如果两者可以建立一一映射，那么结论成立
      - 令 $B=AU$
        - 如果 $U$ 是整数幺模矩阵：$A,B$ 是同一个格的基，显然成立
        - 如果 $U$ 是上三角矩阵且主对角线全为 $1$
            - 用反证法：假设存在 $A$ 中的两个点 $Z_1=Az_1,Z_2=Az_2$ 被映射到同一个点 $(z1,z2 \in [0,1)^n)$
            - $A(z_1-z_2)=0 \mod B \rightarrow BU^{-1}(z_1-z_2) \in L(B)$
            - $U^{-1}(z_1-z_2)$ 是整数向量，且$\Delta z=z_1-z_2 \in (-1,1)^n$，$U^{-1}$ 是上三角矩阵且主对角线全为 $1$
                > 注意 $\Delta z$ 各项的值域中只有 $0$ 一个整数，也就是说如果 $\Delta z$ 中某一项为整数则必然是 $0$
                - $
                    \left[
                        \begin{matrix}
                            1 & * & * & \cdots & * \\
                            0 & 1 & * & \cdots & * \\
                            0 & 0 & 1 & \cdots & * \\
                            \vdots & \vdots & \vdots & \ddots & \vdots \\
                            0 & 0 & 0 & \cdots & 1
                        \end{matrix}
                    \right]
                    \left[
                        \begin{matrix}
                            \Delta z_1 \\
                            \Delta z_2 \\
                            \Delta z_3 \\
                            \vdots\\
                            \Delta z_n
                        \end{matrix}
                    \right]=
                    \left[
                        \begin{matrix}
                            a_1 \\
                            a_2 \\
                            a_3 \\
                            \vdots\\
                            a_n
                        \end{matrix}
                    \right]
                $
                - 数学归纳法证明 $\Delta z=0$：
                  - 显然 $a_n=\Delta z_n=0$
                  - 如果 $\Delta z_{m+1}=\Delta z_{m+2}=...=\Delta z_n=0$，那么 $a_m=\Delta z_m+\sum 0=\Delta z_m=0$       
- 模格的结果
    - 考虑施密特基。任意格基 $B=\widetilde BU$，而 $\widetilde B$ 是一个『旋转方盒』
      - 注意 $||\widetilde B||_\infty \leq ||B||_\infty$
  - 假设$B$ 是格上『最短』的基，即 $||\widetilde B||_\infty \leq ||B||_\infty \leq \lambda_n$，那么显然在 $s \geq 5\lambda_n$ 时得到所求分布

---
## 最短独立向量问题（SIVP）到 SIS 的归约
- 二分一个可能的 $\lambda_n$
- 考虑格 $L$ 的一个格基 $B$，将它的每个向量长度变成 $1/q$，获得另一个格 $L'$ 及其格基 $B'$
  - 利用当前的 $\lambda_n$ 进行正态分布采样并取模、近似到 $L'$ 上（按之前的讨论，这应当是均匀分布的），重复 $m$ 次
  - 以这些采样点在 $L'$ 上的坐标 $[A_1,A_2,...,A_m](A_i \in \Z_q^n)$ 构造一个 SIS 问题并获得解 $Z \in \{-1,0,1\}^n$
    - 如果能获得解 $Z$，即 $Z$ 是一个 $L$ 上的格点，那么可以用 $||Z||_\infty$ 更新 $\lambda_n$，此时 $Z$ 即为所求向量组
    - 如果找不到解或 $||A'||_\infty$ 太大，那么再调整 $\lambda_n$