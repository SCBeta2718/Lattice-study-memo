# Lesson 1：基于密码学中格的基础知识相关介绍

## 格的基本概念与格基变换

- 格的定义
  - $\R^n$ 的一个离散加法子群
    - **不依赖基！**
- 格基
  - 一组向量基
      - **不唯一**
  - 格点可以表示为基的整系数线性组合：$\sum a_ie_i, (a_i \in \N)$
  - 基本区域：$\R^n$ 上**仅包含一个格点**的陪集
      - 一般采用一组基构成的多边形：$\sum a_ie_i, (a \in \{0,1\})$
  - 格基变换：
      - 变换前后格不变
      - 可行的变换：
        - 不变：$a_i \leftarrow a_i$
        - 交换位置：$swap(a_i,b_i)$
        - 取反：$a_i \leftarrow -a_i$
        - 相加：$a_i \leftarrow a_i+b_i$
            - $a_i \leftarrow a_i+kb_i$
        - **不能数乘！！**
      - 本质：左乘幺模矩阵
        > 幺模矩阵：$|\det U|=1$
      - 证明左乘幺模矩阵下格不变：
          - 思路：分开讨论
            > 幺模矩阵是对乘法封闭的群，利用行列式的乘法和逆元性质可证。
          - 令格基矩阵 $B=[e_1,e_2,...,e_n],(e_i={b_{i1},b_{i2},...,b_{im}})$
          - 相加（以变换 $e_3$ 为例）：
            - $
                B'=
                \left[
                    \begin{matrix}
                        1 & 0 & k_{31} & \cdots &0 \\
                        0 & 1 & k_{32} & \cdots & 0 \\
                        0 & 0 & 1 & \cdots & 0 \\
                        \vdots & \vdots & \vdots & \ddots & \vdots\\
                        0 & 0 & k_{3n} & \cdots & 1 \\
                    \end{matrix}
                \right]B
            $
            - 考虑 $B_i$ 行的代数余子式即证
          - 取反：
            - $
                B'=
                \left[
                    \begin{matrix}
                        (-1)^{k_1} & 0 & 0 & \cdots &0 \\
                        0 & (-1)^{k_2} & 0 & \cdots & 0 \\
                        0 & 0 & (-1)^{k_3} & \cdots & 0 \\
                        \vdots & \vdots & \vdots & \ddots & \vdots\\
                        0 & 0 & 0 & \cdots & (-1)^{k_n} \\
                    \end{matrix}
                \right]B
            $
          - 交换位置：相当于单位矩阵行交换
      - 格的行列式
        - 基本区域面积
        - 性质：在变换下不变
          - 证明：利用行列式的几何意义
            > **行列式的几何意义**：基向量张成的体积

---
## 最短向量问题：求格上最短的非零向量（集）

- 第 $i$ 短的向量记为 $\lambda_i$
- 一般采用欧几里得范数（2-范数）
  > **向量的范数**：$||a||_n=\sqrt[n]{\sum a_i^n}$，表示一种『距离』
  > - $||a||_\infty=\max a_i$
  >   - 渐进上只与 $\max a_i$ 相关
- 也可以理解为从原点向外碰到另一点的最小圆半径
  - 想象波的扩散过程
- 施密特基本区域
  - 对格基做施密特正交化后张成的区域是一个基本区域
    - 施密特基对任意格的唯一性证明：该基本区域**是笛卡尔系的一个旋转压缩**
    > **施密特正交化**：
    > - 每一个向量减去它在之前向量的投影
    >   - $v_i'=v_i-\sum_{j=1}^{i-1}{\langle {v_i,v_j'} \rangle \over \langle {v_j',v_j'} \rangle}v_j'$
    > - 将结果单位化
    > - 投影推导过程：${\langle {v_i,v_j'} \rangle \over \langle {v_j',v_j'} \rangle}v_j'={\langle {v_i,v_j'} \rangle \over |v_j'|}{v_j' \over |v_j'|}=|v_i \rightarrow v_j'|e_j'$
    > - **施密特正交化是 $\R^n$ 上的操作，不是格上的**  
  - 任意**格基**可被写为 $B=ER$，$E$ 是施密特基组成的矩阵，$R$ 是上三角矩阵，$R$ 的主对角线为 $\{|v_1'|,|v_2'|,...,|v_n'|\}$
    - 本质是 QR 分解
    - **$E$ 是笛卡尔系的一个旋转压缩，对格唯一，所以只需考虑 $R$**
  - $|\det B|=|\det R|$：$E$ 是正交矩阵，$|\det E|=1$
    > $|\det E|=1$ 的证明利用行列式的几何含义
  - $|\lambda_1| \geq \min |v_i'|$
    - 考虑三角不等式（勾股定理亦可），$|\lambda_1| \geq \max{\lambda_1}_i$
    - 令 $\lambda_1=BA=ERA=E(RA),(A=[a_1,a_2,...,a_n],a_i \in \N, \exist a_i \not ={0})$
    - 设 $A=[a_1,a_2,...,a_m,0,0,...,0], a_m \not ={0}$，则 $|\lambda_1| \geq \max{\lambda_1}_i \geq {\lambda_1}_m \geq R_{mm}a_m=|v_m'|a_m \geq |v_m'|$（三角不等式）
      - 注意 $R$ 是上三角阵所以 $R_{mm}$ 项必然存在
- 闵可夫斯基定理：对于任意 $n$ 维格 $L$ 和一个关于原点对称的凸区域 $S,(|S|>2^n\det L)$，$S$ 中必然包含一个格点（原点除外）
  - Blichfeldt 引理：对于任意格 $L$，以及任意区域 $S,(|S|>\det L)$，都存在一个格 $L$ 中的向量 $\vec {z_1z_2},(z_1,z_2 \in S)$
    - 对于格上每一个点，都在固定的相对位置『放置』一个区域 $S$
    - $|S|>\det L$，所以这些点集之间会重合
    - 考察某个区域 $S_0$ 中与区域 $S_1$ 重合的区域，在其中取一点 $z_1$
    - 基于该点在 $S_1$ 中的相对位置，在 $S_0$ 中作它的像，记作 $z_2$
    - 由于格点和区域一一对应，显然 $z_1$ 和 $z_2$ 之间将间隔一个格 $L$ 中的向量，且 $z_1,z_2 \in S$
  - 闵可夫斯基定理证明：
    - 将 $S$ 以原点为中心缩小至原来的 $1/2$，记为 $S/2$
    - $|S/2|=|S|/2^n > \det L$
    - 由 Blichfeldt 引理，$S/2$ 中存在一个格 $L$ 中的向量，记为$\vec {z_1z_2}$。显然，$2z_1 \in S,-2z_2 \in S$
    - 记点 $Z=mid(2z_1,-2z_2)=z_1-z_2$，由 $S$ 是凸区域，所以 $Z \in S$
    - 显然，$\vec {OZ}$ 是一个格 $L$ 中的向量，原点是格点，所以 $Z$ 是格点且 $Z \in S$
  - 推论：$|\lambda_1| \leq \sqrt n (\det L)^{1/n}$
    - 思想：构造 $S$，使得 $|S|>2^n\det L$，由闵可夫斯基定理，$S$ 中存在格点。该格点离原点的距离上界（即 $S$ 的最大半径）同时就是 $|\lambda_1|$ 的一个上界。
    - 考虑以笛卡尔坐标系的基为格基的情况 $(\det L=1)$
      - 考虑点 $(1,1,1,...,1)$，以原点为球心，到该点的向量为半径作 $n$ 维球，记为 $S$。显然 $R_S=\sqrt n$
      - $S$ 体积大于其内切立方体，即 $|S|>2^n=2^n(\det L)^{1/n}$
      - $|\lambda_1| \leq \sqrt n$
    - 对于任意格：
      - 笛卡尔坐标系的基左乘格基矩阵进行坐标变换，$|S|$ 的变换系数为 $\det L$，长度变化即为 $(\det L)^{1/n}$
      - $|\lambda_1| \leq \sqrt n (\det L)^{1/n}$
    - 这个界可以优化一些常数
- 这些上界和下界都是**非构造性**的，构造出解是**困难**的

---
## 其他格上困难问题
- 一些简单问题：
  - 验证向量是否在格上（高斯消元）
  - 给出两个格基 $B_1,B_2$ 判断等价性
    - 方法一：利用等价变换，证 $B_1B_2^{-1} \in U$
    - 方法二：取每个基求是否在另一个格上
- 困难问题：
  - 最短向量问题（SVP）
    - 近似最短向量问题（γ-SVP）：求长度为最短向量的 $\gamma$ 倍
    - 判定近似最短向量长度的界（γ-GapSVP）：给出较小常数 $\gamma$，询问最短向量长度与 $\gamma$ 的关系
  - 最短独立向量问题（SIVP）：求一个较短的线性无关向量组 $B=[b_1,b_2,...,b_n]$，使得 $||B||_\infty$ 最小
      - 显然可以**非构造性地**取得 $||B||_\infty \leq \lambda_n$
    - 近似最短独立向量问题（γ-SIVP）：取得 $B$，使得 $||B||_\infty \leq \gamma \lambda_n$
  - 最近向量问题（CVP）：给出某个 $\R^n$ 上的点，求距离它最近的格点
    - 近似最近向量问题（γ-CVP）：距离在 CVP 答案的 $\gamma$ 倍以内
    - γ-SVP 不难于 γ-CVP（[O. Goldreich, D. Micciancio, S. Safra, and J.P. Seifert, 1999](http://www.wisdom.weizmann.ac.il/~oded/PSX/cvp-svp.pdf)）
- 进展：
  - 1982，LLL 算法
    - 一个多项式算法，解决 $\gamma$ 接近 $2^n$ 时的 γ-SVP 问题
  - 一些指数级算法，但是 $\gamma$ 很小
  - 在特定参数下上述问题似乎是介于 NP 到 NP-Hard 之间的
    - 密码学主要关注 $\gamma \in [n,n^2]$