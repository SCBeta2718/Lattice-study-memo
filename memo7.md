# 理想格及其应用

## 理想格的数学结构
- 循环格
  - 对于 $L \in \Z^n$，如果 $L$ 是循环格，它应该满足的性质：
      - 它是格
      - 每个元素的循环移位也在 $L$ 中
  - 如果 $L$ 是 $\Z[x]/\langle x^n-1 \rangle$ 的一个理想，那么 $L$ 就是一个循环格
      > **理想**：
      > - 如果环 $R$ 的非空子集 $I$，对于 $R$ 中的两个代数运算 $+,*$，满足：
      >   - 对任意的 $a,b \in I,r \in R$，有 $a+b \in I$ 与 $r*a \in I$，则 $I$ 是 $R$ 的一个**左理想**
      >   - 前文同上，$a*r \in I$，则是**右理想**
      >   - 既是左理想又是右理想的就是**理想**
      - 证明：
        - 令 $A=[a_0,a_1,a_2,...a_{n-1}]=\sum_0^{n-1} a_ix^i$，则 $Ax=xA=0x^0+\sum_1^{n-1} a_{i-1}x^i+a_{n-1}x^n$
        - 注意到在 $\Z[x]/\langle x^n-1 \rangle$ 环中，$x^n=1$
        - $Ax=xA=0x^0+\sum_1^{n-1} a_{i-1}x^i+a_{n-1}x^0=a_{n-1}x^0+\sum_1^{n-1} a_{i-1}x^i=[a_{n-1},a_0,a_1,...,a_{n-2}]$
            - 乘 $x$ 就是循环右移
        - 加法和取相反数的性质显然，与乘 $x$ 拼起来即证
- 理想格
  - 定义
      - 模数必须是不可分解的多项式
      - 两个元素积的范数不能比范数的积大很多
  - 一些『好』模数
      - $x^n+1$，要求 $n$ 是 $2$ 的幂
      - $\sum_0^{n-1} x^i$，要求 $n$ 是质数
  - $x^n+1$ 下的一些性质（反循环格）
      - $Ax=xA=0x^0+\sum_1^{n-1} a_{i-1}x^i-a_{n-1}x^0=-a_{n-1}x^0+\sum_1^{n-1} a_{i-1}x^i=[-a_{n-1},a_0,a_1,...,a_{n-2}]$

---
## 基于理想格的密码学优化

- Ring-SIS
  - 对于哈希函数 $f_A(z)=Az \mod p$，可以对 $A$ 进行优化
    - 假设 $A \in \Z_p^{n \times m},m=nk,z \in \Z_p^m$
    - 给出 $k$ 个用向量表示的多项式 $a_1,a_2,...,a_k \in \Z_p[x]/\langle x^n+1 \rangle$
    - $A=
        \left[
            \begin{array}{c|c|c|c}
            a_1 & a_2 & \cdots & a_k \\
            a_1x & a_2x & \cdots & a_kx \\
            \vdots & \vdots & \ddots & \vdots \\
            a_1x^{n-1} & a_2x^{n-1} & \cdots & a_kx^{n-1} \\
            \end{array}
        \right]=[A_1|A_2|...|A_k],z=[z_1|z_2|...|z_k]$
    - $Az=\sum A_iz_i$
      - $A_iz_i=(a_iz_i \in \Z_p [x]/\langle x^n+1 \rangle)$
      - 可以 NTT 加速
    - 时间复杂度 $O(kn \log n)=O(m \log n)$
    - 空间复杂度 $O(m)$
- 判定 RLWE 到搜索 RLWE 的归约
  - 考虑在环 $\Z_{17} [x]/ \langle x^4+1 \rangle$ 中，$x^4+1=(x-2)(x-8)(x+2)(x+8)$
    - 任何 $f(x) \in \Z_{17} [x]/ \langle x^4+1 \rangle$ 都可以用 $f(2),f(2^3),f(2^5),f(2^7)$，即 $f(2),f(8),f(-2),f(-8)$ 表示（中国剩余表示）
    > **余数定理**：$f(x) \mod (a-x) =f(a)$
    > - 证明：令 $f(x)=(a-x)G+R$，$f(a)=(a-a)G+R=R$
    - 对于一组判定为真的 $(a,b)$（中国剩余表示），将 $b$ 中的系数逐个替换为随机数，在某一次之后 RLWE 判定将反转
      - 对于反转的这一位，可以通过类似 LWE 的归约方式求值
    - 当我们知道某一个（中国剩余表示下的）系数值，我们就把其他的分量交换到这个位置上
      - 中国剩余表示下各分量可以独立计算
      - 不能随意交换，因为误差 $e$ 的分布会变化
      - $f(x)$ 与 $f(x^3),f(x^5),f(x^7)$ 同分布
        - $f(x)=[f(2),f(2^3),f(2^5),f(2^7)] \\ f(x^3)=[f(2^3),f(2),f(2^7),f(2^5)] \\ f(x^5)=[f(2^5),f(2^7),f(2),f(2^3)] \\ f(x^7)=[f(2^7),f(2^5),f(2^3),f(2)]$
      - 按照上表进行交换即可
  - 在这个特例下我们只利用到 $x^n+1$ 在特定模数下可被分解为一次多项式的积
    - 需要证明对于足够大的 $n$ 都存在这种分解
    - 显然，在复数域下，$x^n+1=\prod_{k=1}^n (x-e^{(2k-1)\pi/n})$
    - 考虑类似 NTT 的过程，我们需要 $\delta_p(g')=2n$
    - 只需要找到 $2n|p-1$，令 $g'=g^{p-1 \over 2n}$，则所求分解即为 $x^n+1=\prod_{k=1}^n (x-g'^{2k-1})$